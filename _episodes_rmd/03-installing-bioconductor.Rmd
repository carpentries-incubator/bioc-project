---
source: Rmd
title: "Installing Bioconductor"
teaching: XX
exercises: XX
questions:
- "How do I install Bioconductor packages?"
objectives:
- "Install BiocManager."
- "Install Bioconductor packages."
keypoints:
- "BiocManager is used to install Bioconductor packages (but also from CRAN and GitHub), and check for updates."
- "BiocManager safely manages packages from the incremental releases of Bioconductor."
- "The BiocManager package is available from the CRAN repository."
---

```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("02-")
stopifnot(require(BiocStyle))
```

> ## Contribute!
> 
> In the following sections:
>
> - Propose interactive elements to engage participants in this episode (e.g., challenges).
>
{: .callout}

# Installing BiocManager

The `r BiocStyle::Biocpkg("BiocManager")` package is the entry point into the Bioconductor package repository.
This package is technically the only Bioconductor package distributed on the CRAN repository.
As such, the package can be installed using the traditional `install.packages()` function.

```{r, eval=FALSE}
install.packages("BiocManager")
```


# Bioconductor releases and current version

The Bioconductor project produces two releases each year, one around April and another one around October.

The April release of Bioconductor coincides with the annual release of R.
In the months leading up to the April release, packages that will feature in that Bioconductor release are tested using the upcoming version of R (i.e., "R-devel").
To access the newly released version of those packages, users must first install the new version of R.

The October release of Bioconductor continues to use the same version of R for that annual cycle (i.e., until the next release, in April).

Each time a new release is produced, the minor version of all the packages in the Bioconductor repository is incremented by one.
In particular, the version of the `r BiocStyle::Biocpkg("BiocVersion")` package is used to represent the version of the Bioconductor project.

> ## Bioconductor package versions
>
> ### Format
>
> Bioconductor packages use the standard format `MAJOR.MINOR.PATCH` to version packages (e.g., `1.13.2`).
> The version number is stored in the `DESCRIPTION` file that is part of every R package.
> Each of `MAJOR`, `MINOR`, and `PATCH` is an integer that is incremented to mark a new release of the corresponding package, following different rules for each field.
>
> ### Major version
>
> Candidate packages in development are expected to set the `MAJOR` field to `0` when submitted to the Bioconductor repository for review.
> When the package is accepted, `MAJOR` is incremented by `1`, to mark its entry into the Bioconductor repository.
> Following acceptance, `MAJOR` often remains the same for the lifetime of the package.
> It should only be incremented by package developers to mark breaking changes to the package infrastructure that require the full attention of users who may need to update their workflow.
>
> However, the `MAJOR` field should never be directly updated.
> Instead, developers should set `MINOR` to `99`, and this will trigger the Bioconductor release process to automatically increment `MAJOR` by `1` and reset `MINOR` to `0` in the next release.
> For instance, a package at version `0.99.15` during the Bioconductor review process will appear at version `1.0.0` when accepted and added to the next release of the Bioconductor package repository.
>
> ### Minor version
>
> The `MINOR` field is automatically updated every 6 months as part of the Bioconductor release process to mark the version of each package that will feature in the upcoming release.
> Simultaneously, when the `MINOR` field is incremented for a new release cycle, the `PATCH` field is reset to `0`.
> For instance, if a package was at version `1.3.5` for Bioconductor release `3.13`, it would be incremented to version `1.4.0` at the start of Bioconductor release `3.14`.
>
> As described above, developers can set `MINOR` to `99` - skipping all values in-between - if they wish to trigger an increment of `MAJOR` for their package in the next release of Bioconductor.
>
> ### Patch version
>
> The `PATCH` field is the field that package developers use most frequently to release new updates of the package within a release cycle.
> Importantly, updates to packages are not deployed to users until the package version is incremented.
> This is crucial to make sure that users cannot install different versions of a package that contain different source code.
> For instance, a package at version `1.3.5` would be incremented to version `1.3.6` to deploy a new version of the package on the Bioconductor repository.
{: .callout}

Once the `r BiocStyle::Biocpkg("BiocManager")` package is installed, the `BiocManager::version()` function displays the version (i.e., release) of the Bioconductor project that is currently active in the R session.

```{r, message=FALSE}
BiocManager::version()
```

It is possible to specify a version of Bioconductor, which in turn will install the latest version of Bioconductor packages for that particular Bioconductor release.
For instance:

```{r, echo=FALSE, results='asis'}
version <- BiocManager::version()
cmd <- sprintf('BiocManager::install(version = "%s")', as.character(version))
cat(
    "~~~",
    cmd,
    "~~~",
    "{: .language-r}",
    sep = "\n")
```

Note that `BiocManager::install(version = ...)` can be used to update a library of Bioconductor packages to a certain version of Bioconductor, either a more recent or an older release.

> ## Release cycle - release and devel branches
>
> ### Release branches
>
> Bioconductor uses the [Git][git-website] version control system to manage its package repository.
> For each new Bioconductor release, a new branch is created in the Git repository; those are referred to as _release_ branches.
> Release branches allow users to install stable versions of packages that were tested together for a given version of Bioconductor.
>
> Development on the _release_ branches is restricted.
> Older _release_ branches are entirely frozen, meaning that no further update is allowed on those branches.
> When users request a package for a given version of Bioconductor, they receive the latest version of the package on the correspoding release branch.
> 
> Only the latest release branch allows updates from package maintainers, but those are restricted to critical bug fixes.
> This means that for each 6-month release cycle, users can expect packages on the latest branch to be reasonably stable.
>
> ### Devel branches
>
> Meanwhile, the main branch of the Git repository (historically called `master`) is referred to as the _devel_ branch.
>
> The _devel_ branch allow developers to continue updating the packages as frequently as they wish, without affecting users or disrupting workflows.
> Typically, packages on the _devel_ branch are mainly used by other developers and the Bioconductor build system, to run tests using the latest code of every package in the Bioconductor repository.
> However, users can also access packages on the _devel_ branch using `BiocManager::install(version = ...)` with `version` set to one minor version greater than the latest Bioconductor _release_ version (e.g. if the latest release is `3.13`, then devel is `3.14`).
>
> ### Transition between devel and release - the release process
>
> After a new release branch is created, the minor version of every single package on the _devel_ branch is incremented by one.
> This includes the `r BiocStyle::Biocpkg("BiocVersion")` package, which marks the value of the next version of Bioconductor.
>
{: .callout}


# Check for updates

The `BiocManager::valid()` function checks the version of currently installed packages, and checks whether a new version is available for any of them on the Bioconductor repository.

Conveniently, if any package can be updated, the function generates and displays the command needed to update those packages.
Users simply need to copy-paste and run that command in their R console.

If everything is up-to-date, the function will simply print `TRUE`.

```{r, message=FALSE}
BiocManager::valid()
```


# Installing packages

The `BiocManager::install()` function is used to install packages.
The function first searches for the requested package(s) on the Bioconductor repository, but falls back on the CRAN repository and also supports installation from GitHub repositories.

For instance, we can install the `r BiocStyle::Biocpkg("BiocPkgTools")` package:

```{r, eval=FALSE}
BiocManager::install("BiocPkgTools")
```


# Explore the package universe

```{r, message=FALSE}
library(BiocPkgTools)
```

> ## Contribute!
>
> - Demonstrate relevant functions of the `r BiocStyle::Biocpkg("BiocPkgTools")` package.
>
{: .callout}

# Finding a suitable package

On the Bioconductor website, the [BiocViews][biocviews-webpage] use a predefined - yet, evolving - set of labels to categorize all the packages available in the Bioconductor project.

At the top level, labels distinguish four major categories of packages by their nature:

- _Software_ packages, that primarily provide classes and methods to process data and perform statistical analyses and implement analytical workflows.
- _Annotation_ packages, that often provide access to databases of biological information, from biological sequences to location of genomic features and mapping between identifiers from different databases.
- _Experiment_ packages, that provide data sets often used in the vignette of _Software_ packages, to demonstrate package functionality.
- _Workflow_ packages, that primarily provide vignettes demonstrating how to combine multiple _Software_, _Annotation_, and _Experiment_ packages into best practices workflows.

Within each category, labels create sub-categories that facilitate efficient searching of packages by prospective users, navigating the hierarchy of labels to iteratively refine the list of package until they identify one or more candidate packages that provide the functionality they are searching for.

[git-website]: https://git-scm.com/
[biocviews-webpage]: https://www.bioconductor.org/packages/release/BiocViews.html
